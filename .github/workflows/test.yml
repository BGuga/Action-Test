name: Create Branch on Fork

on:
  fork:
    branches:
      - main

jobs:
  create-branch:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Get forked user's ID
      id: get-forked-user
      run: |
        FORKED_USER=$(curl -s ${GITHUB_API_URL}/repos/${{ github.repository }}/forks | jq -r '.[0].owner.login')
        echo "Forked user: $FORKED_USER"
        echo "::set-output name=forked_user::$FORKED_USER"
      env:
        GITHUB_API_URL: https://api.github.com

    - name: Create branch on forked repository
      run: |
        FORKED_USER=${{ steps.get-forked-user.outputs.forked_user }}
        NEW_BRANCH_NAME="feature/${{ github.event.after }}"
        
        # Set up Git config
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"

        # Add remote for forked repository
        git remote add fork "https://github.com/$FORKED_USER/${{ github.repository_name }}"

        # Fetch branches from forked repository
        git fetch fork
        
        # Create a new branch
        git checkout -b $NEW_BRANCH_NAME fork/main

        # Push the new branch to the forked repository
        git push fork $NEW_BRANCH_NAME

      env:
        FORKED_USER: ${{ steps.get-forked-user.outputs.forked_user }}
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
